rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // ========================================
    // ADMIN AUTHENTICATION RULES
    // ========================================
    // Allow anyone to READ the admin password for login validation
    // This is safe because password validation happens client-side
    // and the actual admin routes are protected by AuthContext
    match /settings/adminAuth {
      allow read: if true;  // Allow reading password for validation
      allow write: if false; // Prevent password changes from client
    }
    
    // ========================================
    // ORDERS COLLECTION RULES
    // ========================================
    // Allow anyone to create orders (customer submissions)
    // Allow reading all orders (for admin dashboard)
    match /orders/{orderId} {
      allow read: if true;   // Admin dashboard needs to read orders
      allow create: if true; // Customers can create orders
      allow update: if true; // Admin can update order status
      allow delete: if true; // Admin can delete orders
    }
    
    // ========================================
    // WORK APPLICATIONS RULES
    // ========================================
    // Allow anyone to create work applications (job applications)
    // Allow reading all applications (for admin dashboard)
    match /workApplications/{applicationId} {
      allow read: if true;   // Admin dashboard needs to read applications
      allow create: if true; // Anyone can submit job applications
      allow update: if true; // Admin can update application status
      allow delete: if true; // Admin can delete applications
    }
    
    // ========================================
    // CONTAINERS COLLECTION RULES
    // ========================================
    // Container inventory and presets
    match /containers/{containerId} {
      allow read: if true;   // Public can view available containers
      allow write: if true;  // Admin can manage container inventory
    }
    
    // ========================================
    // EXCAVATORS COLLECTION RULES
    // ========================================
    // Excavator inventory and details
    match /excavators/{excavatorId} {
      allow read: if true;   // Public can view available excavators
      allow write: if true;  // Admin can manage excavator inventory
    }
    
    // ========================================
    // EQUIPMENT BOOKINGS RULES
    // ========================================
    // Track equipment availability and bookings
    match /equipmentBookings/{bookingId} {
      allow read: if true;   // Check availability for booking system
      allow create: if true; // Create bookings when orders placed
      allow update: if true; // Update booking status
      allow delete: if true; // Cancel bookings
    }
    
    // ========================================
    // SETTINGS COLLECTION RULES
    // ========================================
    // General application settings
    match /settings/{settingId} {
      allow read: if true;   // Allow reading settings
      allow write: if false; // Prevent client-side setting changes
    }
    
    // ========================================
    // CONSTRUCTIONS REFERENCES RULES
    // ========================================
    // Construction project references and portfolio
    match /constructionsReferences/{referenceId} {
      allow read: if true;   // Public can view construction references
      allow create: if true; // Admin can create new references
      allow update: if true; // Admin can update reference details
      allow delete: if true; // Admin can delete references
    }
    
    // ========================================
    // DEFAULT DENY RULE
    // ========================================
    // Deny access to any other collections not explicitly defined
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
